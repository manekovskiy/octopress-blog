
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Alexander Manekovskiy</title>
  <meta name="author" content="Alexander Manekovskiy">

  
  <meta name="description" content="There is a whitepaper about new features of ASP.NET 4.5, dozens of blog posts, videos from conferences, some tutorials and MSDN.aspx) topic &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://amanek.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/feed/" rel="alternate" title="Alexander Manekovskiy" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28104381-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Alexander Manekovskiy</a></h1>
  
    <h2>Automating Automation</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/feed/" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:amanek.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/what-types-were-added-moved-or-became-public-in-net-4-5-beta/">What Types Were Added, Moved or Became Public in .NET 4.5 Beta</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-20T17:00:06-07:00" pubdate data-updated="true">Apr 20<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There is a <a href="http://www.asp.net/vnext/overview/whitepapers/whats-new">whitepaper</a> about new features of ASP.NET 4.5, dozens of blog posts, videos from conferences, some tutorials and <a href="http://msdn.microsoft.com/en-us/library/ms171868(v=vs.110">MSDN</a>.aspx) topic describing overall changes. But why there are no reports about what types were actually added in .NET 4.5 Beta? Where are lists of &#8220;new types added to assembly N&#8221; or &#8220;types that became public in assembly N&#8221;? I understand that these lists are not very interesting and that it is more convenient to read descriptions of the new features. Nobody cares about details until they start working against you. And this is normal, right and ok, but now I have some free time and I want to share info about new types that were added or became public in .NET 4.5 comparing to .NET 4.0.</p>

<p>Why I became so interested in this? Well, I accidentally found that <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.ifilterexpressionprovider(v=vs.110"><em>System.Web.DynamicData.IFilterExpressionProvider</em></a>.aspx) interface became public. Briefly, this allows to work with <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.queryextender.aspx"><em>QueryExtender</em></a> and finally (I really wanted this since .NET 3.5) support its <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.dynamicfilterexpression.aspx"><em>DynamicFilterExpression</em></a>. <del>Maybe on next weekend I&#8217;ll post</del> I&#8217;ve already posted about <a href="http://amanek.com/?p=100">my experiments with IFilterExpressionProvider</a>, take a look if you are interested, and now lets return to the main topic.</p>

<p>It is pretty simple to do compiled assemblies diff if you have <a href="http://www.ndepend.com/">NDepend</a> or similar tool, but what if you (like me) have no license? I started thinking to enumerate public types via reflection, but soon recalled that <a href="http://www.west-wind.com/weblog/posts/2012/Mar/13/NET-45-is-an-inplace-replacement-for-NET-40">.NET 4.5 beta replaces assemblies of .NET 4.0</a> during installation and Assembly.LoadFrom will not work. To overcome this I decided to parse and compare XML documentation that comes along with all .NET assemblies. Simple as that, every public type is documented and difference between old and new version of documentation will give me at least names of types.</p>

<p>Ok, where to get xml documentation files for .NET 4.0? Binaries with xml docs of .NET 4.0 and 4.5 are located in <em><SysDrive>:\Program Files[(x86)]\Reference Assemblies\Microsoft\Framework.NETFramework</em>.</p>

<p><img class="center" src="/images/posts/reference-assemblies-folder.png" title="Reference assemblies folder location" alt="Reference assemblies folder location"></p>

<p>What I wanted is to get some statistics. There are 969 new public types in .NET 4.5. But it does not mean that those are completely new things, because it is not, it means that out of the box .NET 4.5 Beta has +969 new types comparing to .NET 4.0 and now there are totally 14971 public and documented types in .NET 4.5. Almost 15K only public types - that&#8217;s incredibly huge number.</p>

<p><img class="center" src="/images/posts/comparison-of-types-count-between-net40-and-net45.png" title="Round Diagram showing types count of .NET 4.0 and .NET 4.5 Beta" alt="Round Diagram showing types count of .NET 4.0 and .NET 4.5 Beta"></p>

<p>Most of new types are located in <em>System.IdentityModel</em>, <em>System.Web</em> and <em>System.Windows.Controls.Ribbon</em> assemblies. Taking into account that <em>System.IdentityModel</em> is providing authentication and authorization features and <em>System.Windows.Controls.Ribbon</em> is UI library allowing use of Microsoft Ribbon for WPF, we can make a conclusion that vast amount of new changes is connected with web.</p>

<p><img class="center" src="/images/posts/new-types-count-by-assembly.png" title="Histogram of new types count by asembly" alt="Histogram of new types count by asembly"></p>

<p>But the most interesting thing was to examine minor changes and see that something new and really useful has been added. And I encourage you to look over list of new classes and I bet you will find something interesting.</p>

<p>LINQPad script with which I did the documentation comparison is listed below. Excel report with some diagrams is also available <a href="https://docs.google.com/open?id=0B4z0as-FFbTdaUVlOXZBblctRDQ">online</a>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="c1">// in case of non 64 bit system change &quot;Program Files (x86)&quot; to &quot;Program Files&quot;</span>
</span><span class='line'>  <span class="kt">string</span> <span class="n">net40Dir</span> <span class="p">=</span> <span class="s">@&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.0\&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">string</span> <span class="n">net45Dir</span> <span class="p">=</span> <span class="s">@&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.5\&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 1. Get all types from all xml doc files in both directories that are containing .NET assemblies and group them by assemblies</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">net40Grouped</span> <span class="p">=</span> <span class="n">GetPublicTypesByAssembly</span><span class="p">(</span><span class="n">net40Dir</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">net45Grouped</span> <span class="p">=</span> <span class="n">GetPublicTypesByAssembly</span><span class="p">(</span><span class="n">net45Dir</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 2. Get list of newly added assemblies</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">newAssemblies</span> <span class="p">=</span> <span class="n">net45Grouped</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="n">net40Grouped</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;New assemblies in .NET 4.5 Beta: (total count - {0})&quot;</span><span class="p">,</span> <span class="n">newAssemblies</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>  <span class="n">newAssemblies</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 3. Get all assemblies that are not present in .NET 4.5 beta</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">nonExistentAssemblies</span> <span class="p">=</span> <span class="n">net40Grouped</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="p">!</span><span class="n">net45Grouped</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Assemblies that are not present in .NET 4.5 Beta folder comparing to .NET 4.0: (total count - {0})&quot;</span><span class="p">,</span> <span class="n">nonExistentAssemblies</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>  <span class="n">nonExistentAssemblies</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 4. Get all new types in .NET 4.0 and .NET 4.5 Beta assemblies</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">net40</span> <span class="p">=</span> <span class="n">net40Grouped</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">net45</span> <span class="p">=</span> <span class="n">net45Grouped</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">var</span> <span class="n">newTypes</span> <span class="p">=</span> <span class="n">net45</span><span class="p">.</span><span class="n">Except</span><span class="p">(</span><span class="n">net40</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Types count in .NET 4.0:|{0}&quot;</span><span class="p">,</span> <span class="n">net40</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Types count in .NET 4.5 Beta:|{0}&quot;</span><span class="p">,</span> <span class="n">net45</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;New types count in .NET 4.5 Beta comparing to .NET 4.0:|{0}&quot;</span><span class="p">,</span> <span class="n">newTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 5. Get assemblies that are containing new types</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">assembliesWithChanges</span> <span class="p">=</span> <span class="n">net45Grouped</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">newTypes</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">type</span> <span class="p">=&gt;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ContainsValue</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="n">Value</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// 6. Remove existent in .NET 4.0 types from assembliesWithChanges to get clear lists of new types grouped by assemblies</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">newTypesGrouped</span> <span class="p">=</span> <span class="n">assembliesWithChanges</span>
</span><span class='line'>      <span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">typesGroup</span> <span class="p">=&gt;</span> <span class="n">typesGroup</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">typesGroup</span> <span class="p">=&gt;</span> <span class="n">typesGroup</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Except</span><span class="p">(</span><span class="n">net40</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&gt;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">ToList</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;New types by assembly:&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">assemblyWithNewTypes</span> <span class="k">in</span> <span class="n">newTypesGrouped</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;{0}|{1}&quot;</span><span class="p">,</span> <span class="n">assemblyWithNewTypes</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">assemblyWithNewTypes</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>      <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">typeName</span> <span class="k">in</span> <span class="n">assemblyWithNewTypes</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">typeName</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">GetPublicTypesByAssembly</span><span class="p">(</span><span class="kt">string</span> <span class="n">xmlDocsDirectory</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">string</span><span class="p">[]</span> <span class="n">xmlDocFiles</span> <span class="p">=</span> <span class="n">Directory</span><span class="p">.</span><span class="n">GetFiles</span><span class="p">(</span><span class="n">xmlDocsDirectory</span><span class="p">,</span> <span class="s">&quot;*.xml&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">xmlDoc</span> <span class="k">in</span> <span class="n">xmlDocFiles</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">root</span> <span class="p">=</span> <span class="n">XDocument</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">xmlDoc</span><span class="p">).</span><span class="n">Root</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">root</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kt">var</span> <span class="n">members</span> <span class="p">=</span> <span class="n">root</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;members&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">members</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="kt">var</span> <span class="n">typesByAssembly</span> <span class="p">=</span> <span class="n">members</span><span class="p">.</span><span class="n">Elements</span><span class="p">(</span><span class="s">&quot;member&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;T:&quot;</span><span class="p">))</span>
</span><span class='line'>          <span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">GetHashCode</span><span class="p">(),</span> <span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">2</span><span class="p">)</span> <span class="cm">/* T: */</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">result</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">GetFileNameWithoutExtension</span><span class="p">(</span><span class="n">xmlDoc</span><span class="p">)</span> <span class="p">+</span> <span class="s">&quot;.dll&quot;</span><span class="p">,</span> <span class="n">typesByAssembly</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And at the end here are links that will help a bit to embrace the changes of .NET 4.5 Beta:</p>

<ul>
<li><a href="http://msdn.microsoft.com/en-us/library/ms171868(v=vs.110).aspx">What&#8217;s New in the .NET Framework 4.5 Beta</a></li>
<li><a href="http://channel9.msdn.com/Events/BUILD/BUILD2011/TOOL-813T">Deep dive into the kernel of the .NET Framework</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/bb822049(v=vs.110).aspx">.NET Framework Versions and Dependencies</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/ee461502(v=vs.110).aspx">What&#8217;s Obsolete in the .NET Framework</a></li>
<li><a href="http://go.microsoft.com/fwlink/?LinkID=237569">List of known issues in .NET 4.5 Beta</a></li>
</ul>


<p>Happy digging in new .NET and don&#8217;t hesitate sharing!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/how-internet-archive-saved-my-day/">How Internet Archive Saved My Day</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-09T06:09:50-08:00" pubdate data-updated="true">Jan 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>UPDATE: <strong>igoogle_themes.zip</strong> archive is no longer available through Wayback Machine since it is pointing to <strong>mattberseth2.com</strong> which is not working. However archive could be found on my <a href="http://sdrv.ms/XpvZMi" title="igoogle_themes.zip">SkyDrive</a>.</p></blockquote>

<p><img class="right" src="http://www.archive.org/images/wayback.gif" title="Internet Wayback Machine Logo" alt="Internet Wayback Machine Logo"> Today when I had to find a theme for ASP.NET GridView the first resource I found in my memory was <a href="http://mattberseth.com/">Matt Berseth&#8217;s blog</a> (Google also found something for me but I&#8217;m convinced that &#8220;favorites list&#8221; in my memory is a much better and reliable source). Matt had great examples of AJAX control extenders and some other things connected with styling of ASP.NET controls on his site. But while domain still belongs to Matt Berseth, the site is currently down and not available.</p>

<p>Well, I quickly found some references to the article <a href="http://mattberseth.com/blog/2007/11/5_gridview_themes_based_on_goo.html">5 GridView Themes Based on Google&#8217;s Personalized Homepage (igoogle)</a> and tried to get to it with the help of <a href="http://archive.org/">The Internet Archive</a> (aka The Wayback Machine). From the &#8220;About the Wayback Machine&#8221; section:</p>

<blockquote><p>Browse through over 150 billion web pages archived from 1996 to a few months ago.</p></blockquote>

<p>In fact it never helped me, but I wanted to get rarely visited pages or downloads of a big size so it is nothing to complain. And at this time I was interested in recovery of popular resource and to my relief the page was crawled <a href="http://wayback.archive.org/web/*/http://mattberseth.com/blog/2007/11/5_gridview_themes_based_on_goo.html">20 times</a> from the 3rd of November, 2007. And sample project download was also available! So it took me something near to 20 minutes to get what I wanted and this is nothing comparing to the efforts needed to create my own CSS for a GridView.</p>

<p>Thank you Internet Archive, you saved my day!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/building-data-annotations-validator-control-with-client-side-validation/">Building Data Annotations Validator Control With Client-Side Validation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-04T13:16:45-08:00" pubdate data-updated="true">Jan 4<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I had worked on ASP.NET MVC project I really liked how input is validated with Data Annotations attributes. And when I had to return to the Web Forms, and write a simple form with some validation, I was wondering how I lived before with standard validator controls. For me, it was never convenient, when I had to write an enormous amount of server tags just to state that &#8220;this is required field which accepts only numbers in specified range&#8230;&#8221;. Yes, there is nothing terrible in declaration of two or three validation controls instead of one. But, if I had a choice, I would like to write only one validator per field and keep all input validation logic as far as I can from the UI markup. And being a developer the code-only approach is most natural for me.</p>

<p><em>System.ComponentModel.DataAnnotations</em> namespace was introduced in .NET 3.5, and now its classes are supported by wide range of technologies like WPF, Silverlight, RIA Services, ASP.NET MVC, ASP.NET Dynamic Data but not in Web Forms. I thought that someone had already implemented ready-to-use Validator Control with client-side validation, but after searching the Web and most popular open source hosting services I found nothing. Ok, not nothing, but implementations what I have found lacked client-side validation and had some other issues. So I decided to write my own Data Annotations Validator that will also support client-side validation.</p>

<h2>Creating Data Annotations Validator Control</h2>

<h3>Server-Side</h3>

<p>As I wanted to achieve compatibility with existing validation controls (new validator is not a replacement for an old ones, it is just an addition to them), it was decided to inherit from <em>BaseValidator</em>. This class does all necessary initialization on both client- and server-sides and exposes all necessary methods for overriding.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">DataAnnotationsValidator</span> <span class="p">:</span> <span class="n">BaseValidator</span>
</span><span class='line'><span class="p">{</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>First of all <em>EvaluateIsValid</em> method of <em>BaseValidator</em> should be overridden.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">EvaluateIsValid</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">object</span> <span class="k">value</span> <span class="p">=</span> <span class="n">GetControlValidationValue</span><span class="p">(</span><span class="n">ControlToValidate</span><span class="p">);</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="n">ValidationAttribute</span> <span class="n">validationAttribute</span> <span class="k">in</span> <span class="n">ValidationAttributes</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Here, we will try to convert value to type specified on RangeAttibute.</span>
</span><span class='line'>      <span class="c1">// RangeAttribute.OperandType should be either IConvertible or of built in primitive types</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">rangeAttibute</span> <span class="p">=</span> <span class="n">validationAttribute</span> <span class="k">as</span> <span class="n">RangeAttribute</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">rangeAttibute</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">value</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ChangeType</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="n">rangeAttibute</span><span class="p">.</span><span class="n">OperandType</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">validationAttribute</span><span class="p">.</span><span class="n">IsValid</span><span class="p">(</span><span class="k">value</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">ErrorMessage</span> <span class="p">=</span> <span class="n">validationAttribute</span><span class="p">.</span><span class="n">FormatErrorMessage</span><span class="p">(</span><span class="n">DisplayName</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The only interesting aspect of this method is line 16. I&#8217;m using <em>FormatErrorMessage</em> method of <em>ValidationAttribute</em> to use all the goodness like support of resources and proper default error message formatting. So, now there is no need to invent something with error messages.</p>

<p>Next thing to deal with is where to get <em>ValidationAttributes</em> collection. There is <em>System.Web.DynamicData.MetaTable</em> class that could be used to retrieve attributes. It was introduced in the first versions of ASP.NET Dynamic Data and now in 4.0 version of Dynamic Data, <em>MetaTable</em> has a static method <em><a href="http://msdn.microsoft.com/en-us/library/dd989458.aspx">CreateTable</a></em> which accepts <em>Type</em> as input parameter. Why using <em>MetaTable</em>, why not retrieve attributes of <em>Type</em> directly from <em>PropertyInfo</em> for specified property name? Because <em>MetaTable</em> also supports retrieving of custom attributes that are applied to property through <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.metadatatypeattribute.aspx"><em>MetadataTypeAttribute</em></a> and merges attributes applied to property both in metadata class and entity class. And again, why inventing something new when everything that is needed is right here?</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">MetaTable</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">))</span>
</span><span class='line'>  <span class="p">.</span><span class="n">GetColumn</span><span class="p">(</span><span class="n">PropertyName</span><span class="p">).</span><span class="n">Attributes</span>
</span><span class='line'>  <span class="p">.</span><span class="n">OfType</span><span class="p">&lt;</span><span class="n">ValidationAttribute</span><span class="p">&gt;()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&#8217;s look a bit into the future - if we place ObjectType property into <em>DataAnnotationsValidator</em>, it means that we should specify this property for every validator control on page. This is redundancy and leads to copy-pasting which is not acceptable. Lets step aside and create <em>MetadataSource</em> control that will act like metadata provider for validators on page.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">MetadataSource</span> <span class="p">:</span> <span class="n">Control</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="n">Type</span> <span class="n">ObjectType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="n">MetaTable</span> <span class="n">metaTable</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">MetaTable</span> <span class="n">MetaTable</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">metaTable</span> <span class="p">??</span> <span class="p">(</span><span class="n">metaTable</span> <span class="p">=</span> <span class="n">MetaTable</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">(</span><span class="n">ObjectType</span><span class="p">));</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="n">IEnumerable</span> <span class="nf">GetValidationAttributes</span><span class="p">(</span><span class="kt">string</span> <span class="n">property</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">MetaTable</span><span class="p">.</span><span class="n">GetColumn</span><span class="p">(</span><span class="n">property</span><span class="p">).</span><span class="n">Attributes</span><span class="p">.</span><span class="n">OfType</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetDisplayName</span><span class="p">(</span><span class="kt">string</span> <span class="n">objectProperty</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">var</span> <span class="n">displayAttribute</span> <span class="p">=</span> <span class="n">MetaTable</span><span class="p">.</span><span class="n">GetColumn</span><span class="p">(</span><span class="n">objectProperty</span><span class="p">).</span><span class="n">Attributes</span>
</span><span class='line'>          <span class="p">.</span><span class="n">OfType</span><span class="p">()</span>
</span><span class='line'>          <span class="p">.</span><span class="n">FirstOrDefault</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="n">displayAttribute</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="n">objectProperty</span> <span class="p">:</span> <span class="n">displayAttribute</span><span class="p">.</span><span class="n">GetName</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here I also thought about <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.displayattribute.aspx">DisplayAttribute</a> which is used to format default error message. Now how <em>ObjectType</em> of <em>MetadataSouce</em> should be specified? Well, we can do it programmatically on Page_Load or do it.. programmatically with <a href="http://weblogs.asp.net/infinitiesloop/archive/2006/08/09/The-CodeExpressionBuilder.aspx">CodeExpressionBuilder</a> to keep all control setup in one place.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;dav:MetadataSource</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span>
</span><span class='line'>  <span class="na">ID=</span><span class="s">&quot;msFoo&quot;</span>
</span><span class='line'>  <span class="na">ObjectType=</span><span class="s">&quot;&lt;%$ Code: typeof(Foo) %&gt;&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, with existence of <em>MetadataSource</em> all fields of <em>DataAnnotationsValidator</em> are initialized in the OnInit method</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnLoad</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnLoad</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(!</span><span class="n">ControlPropertiesValid</span><span class="p">())</span>
</span><span class='line'>      <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">MetadataSource</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">FindChildControl</span><span class="p">(</span><span class="n">MetadataSourceID</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ValidationAttributes</span> <span class="p">=</span> <span class="n">MetadataSource</span><span class="p">.</span><span class="n">GetValidationAttributes</span><span class="p">(</span><span class="n">ObjectProperty</span><span class="p">);</span>
</span><span class='line'>  <span class="n">DisplayName</span> <span class="p">=</span> <span class="n">MetadataSource</span><span class="p">.</span><span class="n">GetDisplayName</span><span class="p">(</span><span class="n">ObjectProperty</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is all what was needed to provide server-side validation.</p>

<h3>Client-Side</h3>

<p>First of all, lets check what standard validator controls could be replaced with <em>Data Annotations</em> attributes.</p>

<table>
<thead>
<tr>
<th>Data Annotations Attribute </th>
<th> Standard Validator Control </th>
</tr>
</thead>
<tbody>
<tr>
<td>RequiredAttribute          </td>
<td> RequiredFieldValidator     </td>
</tr>
<tr>
<td>StringLengthAttribute      </td>
<td> -                          </td>
</tr>
<tr>
<td>RegularExpressionAttribute </td>
<td> RegularExpressionValidator </td>
</tr>
<tr>
<td>-                          </td>
<td> CompareValidator           </td>
</tr>
<tr>
<td>RangeAttribute             </td>
<td> RangeValidator             </td>
</tr>
</tbody>
</table>


<p>I have no ideas how to replace <em>CompareValidator</em> and I don&#8217;t think it is so critical and necessary to think on it. Time to look how standard validator controls are working on the client side.</p>

<p>Every validator that works on the client side should override <em>AddAttributesToRender</em> method of <em>BaseValidator</em> class. This method adds some fields to resulting javascript object. For example, <em>RequiredFieldValidator</em> adds <em>evaluationfunction</em> and <em>initialvalue</em> fields.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">AddAttributesToRender</span><span class="p">(</span><span class="n">HtmlTextWriter</span> <span class="n">writer</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">base</span><span class="p">.</span><span class="n">AddAttributesToRender</span><span class="p">(</span><span class="n">writer</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">RenderUplevel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kt">string</span> <span class="n">id</span> <span class="p">=</span> <span class="n">ClientID</span><span class="p">;</span>
</span><span class='line'>        <span class="n">HtmlTextWriter</span> <span class="n">expandoAttributeWriter</span> <span class="p">=</span> <span class="p">(</span><span class="n">EnableLegacyRendering</span><span class="p">)</span> <span class="p">?</span> <span class="n">writer</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>        <span class="n">AddExpandoAttribute</span><span class="p">(</span><span class="n">expandoAttributeWriter</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot;evaluationfunction&quot;</span><span class="p">,</span> <span class="s">&quot;RequiredFieldValidatorEvaluateIsValid&quot;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
</span><span class='line'>        <span class="n">AddExpandoAttribute</span><span class="p">(</span><span class="n">expandoAttributeWriter</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="s">&quot;initialvalue&quot;</span><span class="p">,</span> <span class="n">InitialValue</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And resulting javascript block for <em>RequiredFieldValidator</em> will look next:</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">//&lt;![CDATA[</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">rfvSampleTextBox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">all</span> <span class="o">?</span> <span class="nb">document</span><span class="p">.</span><span class="nx">all</span><span class="p">[</span><span class="s2">&quot;rfvSampleTextBox&quot;</span><span class="p">]</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;rfvSampleTextBox&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nx">rfvSampleTextBox</span><span class="p">.</span><span class="nx">controltovalidate</span> <span class="o">=</span> <span class="s2">&quot;tbSampleTextBox&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">rfvSampleTextBox</span><span class="p">.</span><span class="nx">evaluationfunction</span> <span class="o">=</span> <span class="s2">&quot;RequiredFieldValidatorEvaluateIsValid&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nx">rfvSampleTextBox</span><span class="p">.</span><span class="nx">initialvalue</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'><span class="c1">//]]&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After examining source code of standard validator controls I found that every control sets <em>evaluationfunction</em> field that states a name for a javascript function that actually performs validation on the client-side. RequiredFieldValidator evaluation function is represented below.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">function</span> <span class="nx">RequiredFieldValidatorEvaluateIsValid</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">(</span><span class="nx">ValidatorTrim</span><span class="p">(</span><span class="nx">ValidatorGetValue</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">controltovalidate</span><span class="p">))</span> <span class="o">!=</span> <span class="nx">ValidatorTrim</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">initialvalue</span><span class="p">))</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <em>val</em> parameter is a validator object that was initialized with all the fields that were set in the <em>AddAttributesToRender</em> method. Plain and simple, if you need to supply your validator on client-side with some information override <em>AddAttributesToRender</em> and add what you want. To replace standard validators <em>DataAnnotationsValidator</em> is doing a little trick - it adds all standard <em>evaluationfunction</em> names, error messages and all necessary fields that are used by standard validation functions. Evaluation function of <em>DataAnnotationsValidator:</em></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">//&lt;![CDATA[</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">DataAnnotationsValidatorIsValid</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">functionsToEvaluate</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">validatorFunctions</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">errorMessages</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">errorMessages</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;;&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">funcIndex</span> <span class="k">in</span> <span class="nx">functionsToEvaluate</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">functionsToEvaluate</span><span class="p">[</span><span class="nx">funcIndex</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(val)&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="nx">result</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">val</span><span class="p">.</span><span class="nx">errormessage</span> <span class="o">=</span> <span class="nx">errorMessages</span><span class="p">[</span><span class="nx">funcIndex</span><span class="p">];</span>
</span><span class='line'>          <span class="nx">val</span><span class="p">.</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">errorMessages</span><span class="p">[</span><span class="nx">funcIndex</span><span class="p">];</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//]]&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This function is registered in the <em>OnPreRender</em> stage of control lifecycle.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnPreRender</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">base</span><span class="p">.</span><span class="n">OnPreRender</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">RenderUplevel</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">scriptManager</span> <span class="p">=</span> <span class="n">ScriptManager</span><span class="p">.</span><span class="n">GetCurrent</span><span class="p">(</span><span class="n">Page</span><span class="p">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">scriptManager</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">scriptManager</span><span class="p">.</span><span class="n">IsInAsyncPostBack</span><span class="p">)</span>
</span><span class='line'>            <span class="n">ScriptManager</span><span class="p">.</span><span class="n">RegisterClientScriptResource</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">GetType</span><span class="p">(),</span> <span class="n">DAValidationScriptFileName</span><span class="p">);</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>          <span class="n">Page</span><span class="p">.</span><span class="n">ClientScript</span><span class="p">.</span><span class="n">RegisterClientScriptResource</span><span class="p">(</span><span class="n">GetType</span><span class="p">(),</span> <span class="n">DAValidationScriptFileName</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The only thing that remains is to get list of fields and values that are needed for validation functions. Every <em>Data Annotation</em> validation attribute will have an <em>Adapter</em> class that stores an array of <em>ClientValidationRule</em> classes. <em>ClientValidationRule</em> is just a container for storing javascript object <em>field names</em> and <em>evaluationfunction</em>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ClientValidationRule</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">EvaluationFunction</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;</span> <span class="n">Parameters</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="kt">string</span> <span class="n">ErrorMessage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">ClientValidationRule</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Parameters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;();</span>
</span><span class='line'>        <span class="n">EvaluationFunction</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And <em>ValidationAttributeAdapter</em> acts like a bridge between existing <em>ValidationAttibute</em> and its <em>ClientValidationRules.</em></p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">internal</span> <span class="k">class</span> <span class="nc">ValidationAttributeAdapter</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">protected</span> <span class="n">ValidationAttribute</span> <span class="n">Attribute</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">protected</span> <span class="kt">string</span> <span class="n">DisplayName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">protected</span> <span class="kt">string</span> <span class="n">ErrorMessage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="nf">ValidationAttributeAdapter</span><span class="p">(</span><span class="n">ValidationAttribute</span> <span class="n">attribute</span><span class="p">,</span> <span class="kt">string</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Attribute</span> <span class="p">=</span> <span class="n">attribute</span><span class="p">;</span>
</span><span class='line'>        <span class="n">DisplayName</span> <span class="p">=</span> <span class="n">displayName</span><span class="p">;</span>
</span><span class='line'>        <span class="n">ErrorMessage</span> <span class="p">=</span> <span class="n">Attribute</span><span class="p">.</span><span class="n">FormatErrorMessage</span><span class="p">(</span><span class="n">DisplayName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">virtual</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">ClientValidationRule</span><span class="p">&gt;</span> <span class="n">GetClientValidationRules</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Enumerable</span><span class="p">.</span><span class="n">Empty</span><span class="p">&lt;</span><span class="n">ClientValidationRule</span><span class="p">&gt;();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>All <em>ValidationAttributeAdapter</em> classes are registered within <em>ValidationAttributeAdapterFactory</em> in a <em>Dictionary</em>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">ValidationAttribute</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="n">ValidationAttributeAdapter</span><span class="p">&gt;&gt;</span> <span class="n">PredefinedCreators</span>
</span><span class='line'>    <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">Type</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">ValidationAttribute</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="n">ValidationAttributeAdapter</span><span class="p">&gt;&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">RangeAttribute</span><span class="p">),</span>
</span><span class='line'>            <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">RangeAttributeAdapter</span><span class="p">(</span><span class="n">attribute</span> <span class="k">as</span> <span class="n">RangeAttribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'>        <span class="p">},</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">RegularExpressionAttribute</span><span class="p">),</span>
</span><span class='line'>            <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">RegularExpressionAttributeAdapter</span><span class="p">(</span><span class="n">attribute</span> <span class="k">as</span> <span class="n">RegularExpressionAttribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'>        <span class="p">},</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">RequiredAttribute</span><span class="p">),</span>
</span><span class='line'>            <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">RequiredAttributeAdapter</span><span class="p">(</span><span class="n">attribute</span> <span class="k">as</span> <span class="n">RequiredAttribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'>        <span class="p">},</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">typeof</span> <span class="p">(</span><span class="n">StringLengthAttribute</span><span class="p">),</span>
</span><span class='line'>            <span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">StringLengthAttributeAdapter</span><span class="p">(</span><span class="n">attribute</span> <span class="k">as</span> <span class="n">StringLengthAttribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">ValidationAttributeAdapter</span> <span class="nf">Create</span><span class="p">(</span><span class="n">ValidationAttribute</span> <span class="n">attribute</span><span class="p">,</span> <span class="kt">string</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Debug</span><span class="p">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">attribute</span> <span class="p">!=</span> <span class="k">null</span><span class="p">,</span> <span class="s">&quot;attribute parameter must not be null&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Debug</span><span class="p">.</span><span class="n">Assert</span><span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">displayName</span><span class="p">),</span> <span class="s">&quot;displayName parameter must not be null, empty or whitespace string&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Added suport for ValidationAttribute subclassing. See http://davalidation.codeplex.com/workitem/695</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">baseType</span> <span class="p">=</span> <span class="n">attribute</span><span class="p">.</span><span class="n">GetType</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Func</span><span class="p">&lt;</span><span class="n">ValidationAttribute</span><span class="p">,</span> <span class="kt">string</span><span class="p">,</span> <span class="n">ValidationAttributeAdapter</span><span class="p">&gt;</span> <span class="n">predefinedCreator</span><span class="p">;</span>
</span><span class='line'>    <span class="k">do</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(!</span><span class="n">PredefinedCreators</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">baseType</span><span class="p">,</span> <span class="k">out</span> <span class="n">predefinedCreator</span><span class="p">))</span>
</span><span class='line'>            <span class="n">baseType</span> <span class="p">=</span> <span class="n">baseType</span><span class="p">.</span><span class="n">BaseType</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">while</span> <span class="p">(</span><span class="n">predefinedCreator</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">baseType</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">baseType</span> <span class="p">!=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Attribute</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">predefinedCreator</span> <span class="p">!=</span> <span class="k">null</span>
</span><span class='line'>        <span class="p">?</span> <span class="n">predefinedCreator</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">)</span>
</span><span class='line'>        <span class="p">:</span> <span class="k">new</span> <span class="n">ValidationAttributeAdapter</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">displayName</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As I said previously, idea was borrowed directly from ASP.NET MVC, so if you are familiar with its validation mechanisms you don&#8217;t need to learn how it works here. Approach here is almost identical to ASP.NET MVC which was <a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html">described</a> well by Brad Wilson. As in ASP.NET MVC <em>DAValidation.IClientValidatable</em> interface exposes an extension point and we can now create a custom validation attribute, implement <em>IClientValidatable</em> interface, write validation function or mix existing ones and get both server- and client-side validation. There is a great set of validation attributes - <a href="http://dataannotationsextensions.org/">Data Annotations Extensions</a> created by <a href="http://weblogs.asp.net/srkirkland/">Scott Kirkland</a> so it is only client function must be changed in order to use them with <em>DataAnnotationsValidator</em>.</p>

<figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IClientValidatable</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">ClientValidationRule</span><span class="p">&gt;</span> <span class="n">GetClientValidationRules</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And that&#8217;s all, now we have fully functional control that makes validation with Data Annotations possible in the ASP.NET Web Forms universe.</p>

<p>Complete source code could be found on <a href="http://davalidation.codeplex.com/">Codeplex</a>. There you can download latest version of control and example project.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/about-me/">About Me</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-02T09:33:15-07:00" pubdate data-updated="true">May 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Welcome!</p>

<p>My name is Alexander Manekovskiy. I&#8217;m .NET developer currently working in <a href="http://bit.biz.ua">BIT</a>, where my main duties are to develop and maintain couple of .NET based solutions and sometimes represent company on regional IT conferences and meetings. Also I&#8217;m working as a trainer at <a href="http://itstep.org">ITStep</a>.</p>

<p>I work primarily on the Microsoft .NET technologies stack and my experience is mainly connected with different intranet web-based applications which were tightly integrated with various 3rd party solutions and products such as Microsoft Office, Adobe InDesign, different Storefronts, CRM systems, etc.</p>

<p>I like trying new things and I&#8217;m always open to new interesting ideas and concepts. And in this blog I&#8217;m going to write about practices, tools and ideas that in my mind could be useful or just interesting for .NET developer. The second idea of running this blog is to have an online 24/7 memory stick.</p>

<p>I&#8217;m always open to cooperation and you can freely contact me by email or skype:</p>

<p><strong>Email</strong>: manekovskiy[at]gmail.com
<strong>Skype</strong>: alexander.manekovskiy</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/better-command-line-experience-on-windows-with-conemu-clink-and-oh-my-posh/">Better Command Line Experience on Windows With ConEmu, Clink and Oh My Posh</a>
      </li>
    
      <li class="post">
        <a href="/why-your-team-should-do-a-code-review-on-a-regular-basis/">Why Your Team Should Do a Code Review on a Regular Basis</a>
      </li>
    
      <li class="post">
        <a href="/generate-typescript-interfaces-from-net-assemblies-using-t4-templates/">Generate TypeScript Interfaces From .NET Assemblies Using T4 Templates</a>
      </li>
    
      <li class="post">
        <a href="/how-ive-fixed-my-dell-inspiron-overheating-issues/">How I&#8217;ve Fixed My Dell Inspiron Overheating Issues</a>
      </li>
    
      <li class="post">
        <a href="/how-to-configure-comemu-task-for-github-for-windows-portable-git/">How to Configure ComEmu Task for GitHub for Windows Portable Git</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/manekovskiy">@manekovskiy</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'manekovskiy',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("amanekdev", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/amanekdev" class="twitter-follow-button" data-show-count="false">Follow @amanekdev</a>
  
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - Alexander Manekovskiy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'amanek';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
