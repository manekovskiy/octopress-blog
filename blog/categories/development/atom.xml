<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Development | Alexander Manekovskiy]]></title>
  <link href="http://manekovskiy.github.com//blog/categories/development/atom.xml" rel="self"/>
  <link href="http://manekovskiy.github.com//"/>
  <updated>2013-03-31T19:19:50+03:00</updated>
  <id>http://manekovskiy.github.com//</id>
  <author>
    <name><![CDATA[Alexander Manekovskiy]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Configuring Web Forms Routing With Custom Attributes]]></title>
    <link href="http://manekovskiy.github.com//configuring-web-forms-routing-with-custom-attributes/"/>
    <updated>2012-12-23T20:00:20+02:00</updated>
    <id>http://manekovskiy.github.com//configuring-web-forms-routing-with-custom-attributes</id>
    <content type="html"><![CDATA[<blockquote><p><strong>1/13/2013 Update:</strong> Now <em>PhysicalFile</em> property is filled and updated automatically, using <a href="https://github.com/manekovskiy/Web-Forms-Routing-Through-Attributes/blob/master/PhysicalFilePathUpdater.tt">T4 template</a>. Say good-bye to issues caused by typos and copy-pasting.</p></blockquote>

<p>Recently I had to add routing to existent ASP.NET Web Forms application. I was (and I suppose I'm still) new to this thing so I started from <a href="http://msdn.microsoft.com/en-us/library/dd329551(v=vs.100).aspx">Walkthrough: Using ASP.NET Routing in a Web Forms Application</a> and it seemed fine until I started coding.</p>

<p>The site was nothing special but approximately 50 pages. And when I started configuring all these pages it felt wrong - I was lost in all these route names, defaults and constraints. If it felt wrong, I thought, why not to try something else. I googled around and found a pretty good thing - <a href="http://nuget.org/packages/Microsoft.AspNet.FriendlyUrls">ASP.NET FriendlyUrls</a>. Scott Hanselman wrote about this in his <a href="http://www.hanselman.com/blog/IntroducingASPNETFriendlyUrlsCleanerURLsEasierRoutingAndMobileViewsForASPNETWebForms.aspx">Introducing ASP.NET FriendlyUrls - cleaner URLs, easier Routing, and Mobile Views for ASP.NET Web Forms</a> post. At first glance it looked far easier and better, but I wanted to use <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.routeparameter(v=vs.100).aspx"><em>RouteParameters</em></a> for my <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.datasourcecontrol.aspx"><em>datasource</em></a> controls on pages. ASP.NET FriendlyUrls are providing only "URL segment" concept - string that could be extracted from URL (string between '/' characters in URL). URL Segments could not be constrained and thus automatically validated. Also, segments could not have names, so my idea to use <em>RouteParameter</em> would be killed if I'd go with ASP.NET FriendlyUrls.</p>

<p>At the end of this little investigation I thought that it would be easier to tie together route configuration with page class via custom attribute and conventionally named properties for defaults and constraints. So every page class gets its routing configuration as follows:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">namespace</span> <span class="nn">RoutingWithAttributes.Foo</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;[</span><span class="n">MapToRoute</span><span class="p">(</span><span class="n">RouteUrl</span> <span class="p">=</span> <span class="s">&quot;Foo/Edit/{id}&quot;</span><span class="p">)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">Edit</span> <span class="p">:</span> <span class="n">Page</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">RouteValueDictionary</span> <span class="n">Defaults</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">get</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="n">RouteValueDictionary</span> <span class="p">{</span> <span class="p">{</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">}</span> <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">RouteValueDictionary</span> <span class="n">Constraints</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">get</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="k">new</span> <span class="n">RouteValueDictionary</span> <span class="p">{</span> <span class="p">{</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;^[0-9]*$&quot;</span> <span class="p">}</span> <span class="p">};</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The code above states that <em>Edit </em>page in folder <em>Foo</em> of my <em>RoutingWithAttributes</em> web application will be accessible through <em>http://&lt;application-url>/Foo/Edit</em> hyperlink with optional <em>id</em> parameter<em>.</em> Default value for <em>id </em>parameter is empty string but it should be integer number if provided.</p>

<p>For me this works better, it is self describing and I'm not forced to go to some <em>App_Start\RoutingConfig.cs</em> file and search for it. Now how it is working under the hood? Nothing new or special - just a bit of reflection on <em>Application_Start</em> event. And routes are still registered with <em><a href="http://msdn.microsoft.com/en-us/library/system.web.routing.routecollection.mappageroute(v=vs.100).aspx">RouteCollection.MapPageRoute</a> </em>method.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">protected</span> <span class="k">void</span> <span class="nf">Application_Start</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="n">RouteConfig</span><span class="p">.</span><span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">RouteTable</span><span class="p">.</span><span class="n">Routes</span><span class="p">);</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">public</span> <span class="k">class</span> <span class="nc">RouteConfig</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">RegisterRoutes</span><span class="p">(</span><span class="n">RouteCollection</span> <span class="n">routes</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">mappedPages</span> <span class="p">=</span> <span class="n">Assembly</span><span class="p">.</span><span class="n">GetAssembly</span><span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="n">RouteConfig</span><span class="p">))</span>
</span><span class='line'>            <span class="p">.</span><span class="n">GetTypes</span><span class="p">()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">AsEnumerable</span><span class="p">()</span>
</span><span class='line'>            <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">type</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">type</span><span class="p">.</span><span class="n">GetCustomAttributes</span><span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="n">MapToRouteAttribute</span><span class="p">),</span> <span class="k">false</span><span class="p">).</span><span class="n">Length</span> <span class="p">==</span> <span class="m">1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">pageType</span> <span class="k">in</span> <span class="n">mappedPages</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">defaultsProperty</span> <span class="p">=</span> <span class="n">pageType</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;Defaults&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">defaults</span> <span class="p">=</span> <span class="n">defaultsProperty</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">RouteValueDictionary</span><span class="p">)</span><span class="n">defaultsProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">constraintsProperty</span> <span class="p">=</span> <span class="n">pageType</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;Constraints&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">constraints</span> <span class="p">=</span> <span class="n">constraintsProperty</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">RouteValueDictionary</span><span class="p">)</span><span class="n">constraintsProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">dataTokensProperty</span> <span class="p">=</span> <span class="n">pageType</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="s">&quot;DataTokens&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">dataTokens</span> <span class="p">=</span> <span class="n">dataTokensProperty</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">?</span> <span class="p">(</span><span class="n">RouteValueDictionary</span><span class="p">)</span><span class="n">dataTokensProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">)</span> <span class="p">:</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">routeAttribute</span> <span class="p">=</span> <span class="p">(</span><span class="n">MapToRouteAttribute</span><span class="p">)</span><span class="n">pageType</span><span class="p">.</span><span class="n">GetCustomAttributes</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MapToRouteAttribute</span><span class="p">),</span> <span class="k">false</span><span class="p">)[</span><span class="m">0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">routeAttribute</span><span class="p">.</span><span class="n">RouteUrl</span><span class="p">))</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullReferenceException</span><span class="p">(</span><span class="s">&quot;RouteUrl property cannot be null&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">routeAttribute</span><span class="p">.</span><span class="n">PhysicalFile</span><span class="p">))</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">NullReferenceException</span><span class="p">(</span><span class="s">&quot;PhysicalFile property cannot be null&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span><span class="p">(!</span><span class="n">VirtualPathUtility</span><span class="p">.</span><span class="n">IsAppRelative</span><span class="p">(</span><span class="n">routeAttribute</span><span class="p">.</span><span class="n">PhysicalFile</span><span class="p">))</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">&quot;Property should be application relative URL&quot;</span><span class="p">,</span> <span class="s">&quot;PhysicalFile&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">routes</span><span class="p">.</span><span class="n">MapPageRoute</span><span class="p">(</span><span class="n">pageType</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="n">routeAttribute</span><span class="p">.</span><span class="n">RouteUrl</span><span class="p">,</span> <span class="n">routeAttribute</span><span class="p">.</span><span class="n">PhysicalFile</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="n">defaults</span><span class="p">,</span> <span class="n">constraints</span><span class="p">,</span> <span class="n">dataTokens</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Route name is equal to the <em>FullName</em> property of page type. Since <a href="http://msdn.microsoft.com/en-us/library/system.type.fullname.aspx"><em>Type.FullName</em></a> includes both namespace and class name it guarantees route name uniqueness across the application.</p>

<p>To utilize route links generation I had to create two extension methods for <em>Page</em> class. These methods are just wrappers for <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.page.getrouteurl(v=vs.100).aspx"><em>Page.GetRouteUrl</em></a> method.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">PageExtensions</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">GetMappedRouteUrl</span><span class="p">(</span><span class="k">this</span> <span class="n">Page</span> <span class="n">thisPage</span><span class="p">,</span> <span class="n">Type</span> <span class="n">targetPageType</span><span class="p">,</span> <span class="kt">object</span> <span class="n">routeParameters</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">thisPage</span><span class="p">.</span><span class="n">GetRouteUrl</span><span class="p">(</span><span class="n">targetPageType</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="n">routeParameters</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetMappedRouteUrl</span><span class="p">(</span><span class="k">this</span> <span class="n">Page</span> <span class="n">thisPage</span><span class="p">,</span> <span class="n">Type</span> <span class="n">targetPageType</span><span class="p">,</span> <span class="n">RouteValueDictionary</span> <span class="n">routeParameters</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">thisPage</span><span class="p">.</span><span class="n">GetRouteUrl</span><span class="p">(</span><span class="n">targetPageType</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="n">routeParameters</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>So now I can generate link to <em>Foo.Edit</em> page as follows:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>a href=&#39;<span class="ni">&amp;lt;</span>%= Page.GetMappedRouteUrl(typeof(RoutingWithAttributes.Foo.Edit), new { id = 1 }) %<span class="ni">&amp;gt;</span>&#39;<span class="ni">&amp;gt;</span>Foo.Edit<span class="ni">&amp;lt;</span>/a<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And it will produce <em>http://&lt;application-url>/Foo/Edit/1</em> link.</p>

<p>Described approach helped me to accomplish task without frustration and I'm satisfied with the results.</p>

<p>Code for this article is <a href="https://github.com/manekovskiy/Web-Forms-Routing-Through-Attributes">hosted on GitHub</a> feel free to use it if you liked the idea.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Adding Client-Side Validation Support for PhoneAttribute or Fighting the Lookbehind in JavaScript]]></title>
    <link href="http://manekovskiy.github.com//adding-client-side-validation-support-for-phoneattribute-or-fighting-the-look-behind-in-javascript/"/>
    <updated>2012-09-20T22:22:55+03:00</updated>
    <id>http://manekovskiy.github.com//adding-client-side-validation-support-for-phoneattribute-or-fighting-the-look-behind-in-javascript</id>
    <content type="html"><![CDATA[<p>Today, I was working on JavaScript implementation of validation routine for <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.phoneattribute.aspx">PhoneAttribute</a> in context of my hobby project <a href="http://amanek.com/building-data-annotations-validator-control-with-client-side-validation/">DAValidation</a>. Examining the sources of .NET 4.5 showed that the validation is done via regular expression:</p>

<p><img class="center" src="/images/posts/phone-validation-regexp-with-non-supported-lookbehind-highlighted.png" title="Unsupported lookbehind part of phone validation regexp pattern" alt="Unsupported lookbehind part of phone validation regexp pattern"></p>

<p>And here is the problem - the pattern uses lookbehind feature <a href="http://www.regular-expressions.info/lookaround.html">that is not supported in JavaScript</a>.
Quote from <a href="http://www.regular-expressions.info">regular-expressions.info:</a></p>

<blockquote><p>Finally, flavors like <a href="http://www.regular-expressions.info/javascript.html">JavaScript</a>, <a href="http://www.regular-expressions.info/ruby.html">Ruby</a> and <a href="http://www.regular-expressions.info/tcl.html">Tcl</a> do not support lookbehind at all, even though they do support lookahead.</p></blockquote>

<p>This lookbehind is used to match the "+" sign at the beginning of string, i. e. check the existence of the prefix. To make this work in JavaScript pattern should be reversed and lookbehind assertion should be replaced with lookahead (replace prefix check to suffix). And that's it! The resulting pattern is:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="o">^</span><span class="p">(</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="err">\</span><span class="nx">s</span><span class="o">?</span><span class="p">(</span><span class="nx">x</span><span class="o">|</span><span class="p">.</span><span class="nx">txe</span><span class="o">?</span><span class="p">)</span><span class="err">\</span><span class="nx">s</span><span class="o">?</span><span class="p">)</span><span class="o">?</span><span class="p">(()(</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="p">[</span><span class="err">\</span><span class="nx">s</span><span class="o">-</span><span class="p">.]</span><span class="o">?</span><span class="p">)</span><span class="o">?</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="p">(</span><span class="o">|</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="p">)[</span><span class="err">\</span><span class="nx">s</span><span class="o">-</span><span class="p">.]</span><span class="o">?</span><span class="p">)</span><span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="p">()([</span><span class="err">\</span><span class="nx">s</span><span class="o">-</span><span class="p">.]</span><span class="o">?</span><span class="err">\</span><span class="nx">d</span><span class="o">+</span><span class="p">)</span><span class="o">?</span><span class="err">\</span><span class="nx">d</span><span class="o">++?</span><span class="p">((</span><span class="o">?!+</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/em&gt;)|\d+)(\s?+)?$</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>As a proof here is test html page:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>head<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>title<span class="ni">&amp;gt;</span>Phone Number RegExp Test Page<span class="ni">&amp;lt;</span>/title<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/head<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>body<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>script<span class="ni">&amp;gt;</span>
</span><span class='line'>        function validateInput() {
</span><span class='line'>            var phoneRegex = new RegExp(&quot;^(\\d+\\s?(x|\\.txe?)\\s?)?((\\)(\\d+[\\s\\-\\.]?)?\\d+\\(|\\d+)[\\s\\-\\.]?)*(\\)([\\s\\-\\.]?\\d+)?\\d+\\+?\\((?!\\+.*)|\\d+)(\\s?\\+)?$&quot;, &quot;i&quot;);
</span><span class='line'>
</span><span class='line'>            var input = document.getElementById(&quot;tbPhone&quot;);
</span><span class='line'>            var value = input.value.split(&quot;&quot;).reverse().join(&quot;&quot;);
</span><span class='line'>            alert(phoneRegex.test(value));
</span><span class='line'>        }
</span><span class='line'>    <span class="ni">&amp;lt;</span>/script<span class="ni">&amp;gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="ni">&amp;lt;</span>input type=&quot;text&quot; id=&quot;tbPhone&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>button onclick=&quot;javascript:testPhone()&quot;<span class="ni">&amp;gt;</span>Validate<span class="ni">&amp;lt;</span>/button<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/body<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>While working on pattern reversing I was using my favorite regular expressions building and testing tool <a href="http://www.ultrapico.com/Expresso.htm">Expresso</a>. Also, a great article of Steven Levithan <a href="http://blog.stevenlevithan.com/archives/mimic-lookbehind-javascript">Mimicking Lookbehind in JavaScript</a> helped to look deeper and actually find the right solution of the problem.</p>

<p>PS. Now, as I finally finished adding <a href="http://davalidation.codeplex.com/workitem/701">support for new .NET 4.5 validation attributes</a> the new version of <a href="http://davalidation.codeplex.com/">DAValidation</a> will be published soon. Stay tuned ;)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Implement Configurable Dynamic Data Filters in ASP.NET 4.5]]></title>
    <link href="http://manekovskiy.github.com//how-to-implement-configurable-dynamic-data-filters-in-asp-net-4-5/"/>
    <updated>2012-05-01T20:12:00+03:00</updated>
    <id>http://manekovskiy.github.com//how-to-implement-configurable-dynamic-data-filters-in-asp-net-4-5</id>
    <content type="html"><![CDATA[<p>Every time, when we speaking about data driven web applications there is a task of providing data filtering feature or configurable filters with ability to save the search criteria individually for each user. The most convenient filtering experience I have ever encountered were the bug tracking systems. Fast and simple. To get the idea of what I'm talking about just look at <a href="http://www.redmine.org/projects/redmine/issues">Redmine Issues page</a>.
Can we implement something similar with pure ASP.NET, particularly with <a href="http://msdn.microsoft.com/en-us/library/ee845452.aspx"><em>ASP.NET Dynamic Data</em></a>? Why Dynamic Data? Because of its focus on metadata which is set by attributes from <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.aspx">DataAnnotations namespace</a> and convention over configuration approach for building data driven applications. Its simple and convenient, and does not take much efforts to extend it.</p>

<p>For filtering Dynamic Data offers us <a href="http://msdn.microsoft.com/en-us/library/ee377606.aspx#filter_templates"><em>Filter Templates</em></a> with <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.filterrepeater.aspx"><em>FilterRepeater</em></a> control. To get the idea of how Dynamic Data Filter Templates are working I highly recommend reading a great post of <a href="http://www.olegsych.com/">Oleg Sych</a> <a href="http://www.olegsych.com/2010/07/understanding-aspnet-dynamic-data-filter-templates/">"Understanding ASP.NET Dynamic Data: Filter Templates"</a>.</p>

<p>Until .NET 4.5 there were no extension points where we could retake control over filter templates creation. And surprisingly, I found that interface <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.ifilterexpressionprovider(v=vs.110"><em>IFilterExpressionProvider</em></a>.aspx) became public in .NET 4.5. So now we can extend Dynamic Data filtering mechanism.</p>

<h2>ASP.NET Dynamic Data QueryableFilterRepeater</h2>

<p>For the jump start lets remind how List PageTemplate in Dynamic Data looks like:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="ni">&amp;lt;</span>asp:QueryableFilterRepeater runat=&quot;server&quot; ID=&quot;FilterRepeater&quot;&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>ItemTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>asp:Label runat=&quot;server&quot; Text=&#39;<span class="ni">&amp;lt;</span>%# Eval(&quot;DisplayName&quot;) %<span class="ni">&amp;gt;</span>&#39; OnPreRender=&quot;Label_PreRender&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>asp:DynamicFilter runat=&quot;server&quot; ID=&quot;DynamicFilter&quot; OnFilterChanged=&quot;DynamicFilter_FilterChanged&quot; /<span class="ni">&amp;gt;&amp;lt;</span>br /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/ItemTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>/asp:QueryableFilterRepeater&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>asp:GridView ID=&quot;GridView1&quot; runat=&quot;server&quot; DataSourceID=&quot;GridDataSource&quot; &gt;
</span><span class='line'><span class="ni">&amp;lt;</span>%-- Contents and styling omited for brevity --%&gt;
</span><span class='line'><span class="ni">&amp;lt;</span>/asp:GridView&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>asp:EntityDataSource ID=&quot;GridDataSource&quot; runat=&quot;server&quot; EnableDelete=&quot;true&quot; /&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>asp:QueryExtender TargetControlID=&quot;GridDataSource&quot; ID=&quot;GridQueryExtender&quot; runat=&quot;server&quot;&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>asp:DynamicFilterExpression ControlID=&quot;FilterRepeater&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>/asp:QueryExtender&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The purpose of <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.queryablefilterrepeater.aspx"><em>QueryableFilterRepeater</em></a> is to generate set of filters for a set of columns. It should contain <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.dynamicfilter.aspx"><em>DynamicFilter</em></a> control which is the actual placeholder for a <em>FilterTemplate</em> control. <em>QueryableFilterRepeater</em> implements <em>IFilterExpressionProvider</em> interface that is supported by <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.queryextender.aspx"><em>QueryExtender</em></a> via <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.dynamicfilterexpression.aspx"><em>DynamicFilterExpression</em></a> control.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IFilterExpressionProvider</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">IQueryable</span> <span class="nf">GetQueryable</span><span class="p">(</span><span class="n">IQueryable</span> <span class="n">source</span><span class="p">);</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">IQueryableDataSource</span> <span class="n">dataSource</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The complete call sequence is represented on diagram below.</p>

<p><img class="center" src="/images/posts/dynamic-data-queryextender-interactions.png" title="Sequence diagram showing QueryExtender interaction with Dynamic Data controls" alt="Sequence diagram showing QueryExtender interaction with Dynamic Data controls"></p>

<h2>Building Configurable Alternative to QueryableFilterRepeater</h2>

<p>As <em>QueryableFilterRepeater</em> is creating filters automatically, the only thing we can do is to hide <em>DynamicFilter</em> on client- or on server-side. To my mind it is not good idea, so a custom implementation of <em>IFilterExpressionProvider</em> is needed. It should support the same item template model as in <em>QueryableFilterRepeater</em> but with ability to add/remove filter controls between postbacks.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[ParseChildren(true)]</span>
</span><span class='line'><span class="na">[PersistChildren(false)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">DynamicFilterRepeater</span> <span class="p">:</span> <span class="n">Control</span><span class="p">,</span> <span class="n">IFilterExpressionProvider</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IFilterExpressionProvider</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">filters</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IFilterExpressionProvider</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;();</span>
</span><span class='line'><span class="k">private</span> <span class="n">IQueryableDataSource</span> <span class="n">dataSource</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">IQueryable</span> <span class="n">IFilterExpressionProvider</span><span class="p">.</span><span class="n">GetQueryable</span><span class="p">(</span><span class="n">IQueryable</span> <span class="n">source</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">filters</span><span class="p">.</span><span class="n">Aggregate</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">filter</span><span class="p">)</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">filter</span><span class="p">.</span><span class="n">GetQueryable</span><span class="p">(</span><span class="n">current</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">void</span> <span class="n">IFilterExpressionProvider</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">IQueryableDataSource</span> <span class="n">queryableDataSource</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Contract</span><span class="p">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">queryableDataSource</span> <span class="k">is</span> <span class="n">IDynamicDataSource</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Contract</span><span class="p">.</span><span class="n">Assert</span><span class="p">(</span><span class="n">queryableDataSource</span> <span class="p">!=</span> <span class="k">null</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">ItemTemplate</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="n">dataSource</span> <span class="p">=</span> <span class="n">queryableDataSource</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Page</span><span class="p">.</span><span class="n">InitComplete</span> <span class="p">+=</span> <span class="n">InitComplete</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Page</span><span class="p">.</span><span class="n">LoadComplete</span> <span class="p">+=</span> <span class="n">LoadCompeted</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The only disappointing thing is the content generation of <em>DynamicFilter</em> which is done on <em>Page.InitComplete</em> event.</p>

<blockquote><p>Oleg Sych tried to change the situation, but <a href="https://connect.microsoft.com/VisualStudio/feedback/details/588383/dont-use-page-initcomplete-in-queryablefilterrepeater-and-dynamicfilter-controls">his suggestion</a> is closed now and seems nothing will be changed. I just reposted his suggestion on <a href="http://visualstudio.uservoice.com/forums/121579-visual-studio/suggestions/2763785-don-t-use-page-initcomplete-in-queryablefilterrepe">visualstudio.uservoice.com</a> in hope that this time, we will succeed.</p></blockquote>

<p>To make things working, <em>DynamicFilter</em> control should initialize itself via <em>EnsureInit</em> method which is generally speaking responsible for <em>FitlerTempate</em> lookup and loading. In other words to force the <em>DynamicFilter</em> to generate its content this method should be called. The only way to do it is to use reflection, since <em>EnsureInit</em> is private.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">MethodInfo</span> <span class="n">DynamicFilterEnsureInit</span><span class="p">;&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">static</span> <span class="n">DynamicFilterRepeater</span><span class="p">()</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="n">DynamicFilterEnsureInit</span> <span class="p">=</span> <span class="k">typeof</span> <span class="p">(</span><span class="n">DynamicFilter</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="s">&quot;EnsureInit&quot;</span><span class="p">,</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">private</span> <span class="k">void</span> <span class="n">AddFilterControls</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">columnNames</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">foreach</span> <span class="p">(</span><span class="n">MetaColumn</span> <span class="n">column</span> <span class="k">in</span> <span class="n">GetFilteredMetaColumns</span><span class="p">(</span><span class="n">columnNames</span><span class="p">))</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">DynamicFilterRepeaterItem</span> <span class="n">item</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DynamicFilterRepeaterItem</span> <span class="p">{</span> <span class="n">DataItemIndex</span> <span class="p">=</span> <span class="n">itemIndex</span><span class="p">,</span> <span class="n">DisplayIndex</span> <span class="p">=</span> <span class="n">itemIndex</span> <span class="p">};</span>
</span><span class='line'>    <span class="n">itemIndex</span><span class="p">++;</span>
</span><span class='line'>    <span class="n">ItemTemplate</span><span class="p">.</span><span class="n">InstantiateIn</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">DynamicFilter</span> <span class="n">filter</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">FindControl</span><span class="p">(</span><span class="n">DynamicFilterContainerId</span><span class="p">)</span> <span class="k">as</span> <span class="n">DynamicFilter</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">filter</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">CurrentCulture</span><span class="p">,</span>
</span><span class='line'>            <span class="s">&quot;FilterRepeater &#39;{0}&#39; does not contain a control of type &#39;{1}&#39; with ID &#39;{2}&#39; in its item templates&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="n">ID</span><span class="p">,</span>
</span><span class='line'>            <span class="k">typeof</span><span class="p">(</span><span class="n">QueryableFilterUserControl</span><span class="p">).</span><span class="n">FullName</span><span class="p">,</span>
</span><span class='line'>            <span class="n">DynamicFilterContainerId</span><span class="p">));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">filter</span><span class="p">.</span><span class="n">DataField</span> <span class="p">=</span> <span class="n">column</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">item</span><span class="p">.</span><span class="n">DataItem</span> <span class="p">=</span> <span class="n">column</span><span class="p">;</span>
</span><span class='line'>    <span class="n">item</span><span class="p">.</span><span class="n">DataBind</span><span class="p">();</span>
</span><span class='line'>    <span class="n">item</span><span class="p">.</span><span class="n">DataItem</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">filters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">filter</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">filters</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">f</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">DynamicFilterEnsureInit</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="k">new</span> <span class="kt">object</span><span class="p">[]</span> <span class="p">{</span> <span class="n">dataSource</span> <span class="p">}));</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">private</span> <span class="n">IEnumerable</span> <span class="n">GetFilteredMetaColumns</span><span class="p">(</span><span class="n">IEnumerable</span> <span class="n">filterColumns</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">return</span> <span class="n">MetaTable</span><span class="p">.</span><span class="n">GetFilteredColumns</span><span class="p">()</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">column</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">filterColumns</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">column</span><span class="p">.</span><span class="n">Name</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">column</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">column</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">private</span> <span class="k">class</span> <span class="nc">DynamicFilterRepeaterItem</span> <span class="p">:</span> <span class="n">Control</span><span class="p">,</span> <span class="n">IDataItemContainer</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">public</span> <span class="kt">object</span> <span class="n">DataItem</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">internal</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">public</span> <span class="kt">int</span> <span class="n">DataItemIndex</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">internal</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">public</span> <span class="kt">int</span> <span class="n">DisplayIndex</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">internal</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Another problem that should be solved - filter controls instantiation. As it was pointed before, all things in Dynamic Data that are connected with filtering are initialized at <em>Page.InitCompleted</em> event. And if you want your dynamic filters to work, they should be instantiated before or at <em>InitComplete</em> event. So far I see only one way to solve this - method <em>AddFilterControls</em> should be called twice, first time to instantiate filter controls that were present on the page (<em>InitComplete</em> event) and second time for newly added columns that are to be filtered (<em>LoadComplete</em> event).</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">void</span> <span class="nf">InitComplete</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">initComleted</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">addedOnInitCompleteFilters</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">FilterColumns</span><span class="p">);</span>
</span><span class='line'><span class="n">AddFilterControls</span><span class="p">(</span><span class="n">addedOnInitCompleteFilters</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">initComleted</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="k">private</span> <span class="k">void</span> <span class="n">LoadCompeted</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">if</span> <span class="p">(</span><span class="n">loadCompleted</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">AddFilterControls</span><span class="p">(</span><span class="n">FilterColumns</span><span class="p">.</span><span class="n">Except</span><span class="p">(</span><span class="n">addedOnInitCompleteFilters</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">loadCompleted</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Encapsulating DynamicFilterRepeater</h2>

<p><em>DynamicFilterRepeater</em> is only a part of more general component though. Everything it does is rendering of filter controls and providing of filter expression. But to start working, <em>DynamicFilterRepeater</em> needs two things - <em>IQueryableDataSource </em>and list of columns to be filtered. Since filtering across the website should be consistent and unified it would be good to encapsulate <em>DynamicFilterRepeater</em> in <em>UserControl</em> which will serve as HTML layout and a glue between page (with <em>IQueryableDataSource</em>, <em>QueryExtender</em> and data source bound control) and <em>DynamicFilterRepeater</em>. In my example I chose <em>GridView</em>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='aspx-cs'><span class='line'><span class="ni">&amp;lt;</span>asp:Label runat=&quot;server&quot; Text=&quot;Add fitler&quot; AssociatedControlID=&quot;ddlFilterableColumns&quot; /&gt;
</span><span class='line'><span class="ni">&amp;lt;</span>asp:DropDownList runat=&quot;server&quot; ID=&quot;ddlFilterableColumns&quot; CssClass=&quot;ui-widget&quot;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span>AutoPostBack=&quot;True&quot;
</span><span class='line'>ItemType=&quot;<span class="ni">&amp;lt;</span>%$ Code: typeof(KeyValuePair<span class="ni">&amp;lt;</span>string, string<span class="ni">&amp;gt;</span>) %<span class="ni">&amp;gt;</span>&quot;
</span><span class='line'>DataValueField=&quot;Key&quot;
</span><span class='line'>DataTextField=&quot;Value&quot;
</span><span class='line'>SelectMethod=&quot;GetFilterableColumns&quot;
</span><span class='line'>OnSelectedIndexChanged=&quot;ddlFilterableColumns_SelectedIndexChanged&quot;<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>/asp:DropDownList&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">ID=</span><span class="s">&quot;FilterColumns&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>dd:DynamicFilterRepeater runat=&quot;server&quot; ID=&quot;FilterRepeater&quot;&gt;<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;pre&gt;&lt;code&gt;</span><span class="ni">&amp;lt;</span>ItemTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>div<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>asp:Label ID=&quot;lblDisplayName&quot; runat=&quot;server&quot;
</span><span class='line'>            Text=&#39;<span class="ni">&amp;lt;</span>%# Eval(&quot;DisplayName&quot;) %<span class="ni">&amp;gt;</span>&#39;
</span><span class='line'>            OnPreRender=&quot;lblDisplayName_PreRender&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>        <span class="ni">&amp;lt;</span>asp:DynamicFilter runat=&quot;server&quot; ID=&quot;DynamicFilter&quot; /<span class="ni">&amp;gt;</span>
</span><span class='line'>    <span class="ni">&amp;lt;</span>/div<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="ni">&amp;lt;</span>/ItemTemplate<span class="ni">&amp;gt;</span>
</span><span class='line'><span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>/dd:DynamicFilterRepeater&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Remember I have mentioned about two-stage filter controls instantiation and a storage for list of filtered columns? Yes, this user control is a place where list of filtered columns could be stored. To get list of filtered columns before <em>Page.InitComplete</em> event I'm using a little trick - the hidden input field serves as a storage for filtered columns list. Enforcing hidden input to have its ID generated on server makes it possible to retrieve value directly from <em>Page.Form</em> collection at any stage of page lifecycle.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">DynamicFilterForm</span> <span class="p">:</span> <span class="n">UserControl</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="k">public</span> <span class="n">DynamicFilterRepeater</span> <span class="n">FilterRepeater</span><span class="p">;</span>
</span><span class='line'><span class="k">public</span> <span class="n">Type</span> <span class="n">FitlerType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[IDReferenceProperty(typeof(GridView))]</span>
</span><span class='line'><span class="k">public</span> <span class="kt">string</span> <span class="n">GridViewID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[IDReferenceProperty(typeof(QueryExtender))]</span>
</span><span class='line'><span class="k">public</span> <span class="kt">string</span> <span class="n">QueryExtenderID</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="n">MetaTable</span> <span class="n">MetaTable</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">private</span> <span class="n">GridView</span> <span class="n">GridView</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'><span class="k">protected</span> <span class="n">QueryExtender</span> <span class="n">GridQueryExtender</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnInit</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">base</span><span class="p">.</span><span class="n">OnInit</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'>    <span class="n">MetaTable</span> <span class="p">=</span> <span class="n">MetaTable</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">(</span><span class="n">FitlerType</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">GridQueryExtender</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">FindChildControl</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">QueryExtender</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">QueryExtenderID</span><span class="p">);</span>
</span><span class='line'>    <span class="n">GridView</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">FindChildControl</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">GridView</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">GridViewID</span><span class="p">);</span>
</span><span class='line'>    <span class="n">GridView</span><span class="p">.</span><span class="n">SetMetaTable</span><span class="p">(</span><span class="n">MetaTable</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Tricky thing to retrieve list of filter columns directly from hidden field</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">Request</span><span class="p">.</span><span class="n">Form</span><span class="p">[</span><span class="n">FilterColumns</span><span class="p">.</span><span class="n">UniqueID</span><span class="p">]))</span>
</span><span class='line'>        <span class="n">FilterRepeater</span><span class="p">.</span><span class="n">FilterColumns</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">Request</span><span class="p">.</span><span class="n">Form</span><span class="p">[</span><span class="n">FilterColumns</span><span class="p">.</span><span class="n">UniqueID</span><span class="p">].</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">((</span><span class="n">IFilterExpressionProvider</span><span class="p">)</span><span class="n">FilterRepeater</span><span class="p">).</span><span class="n">Initialize</span><span class="p">(</span><span class="n">GridQueryExtender</span><span class="p">.</span><span class="n">DataSource</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnPreRender</span><span class="p">(</span><span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">FilterColumns</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="n">FilterRepeater</span><span class="p">.</span><span class="n">FilterColumns</span><span class="p">);</span>
</span><span class='line'>    <span class="k">base</span><span class="p">.</span><span class="n">OnPreRender</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// event handlers ommited</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<h2>Conclusions</h2>

<p>While this solution works, I'm a bit concerned about it. Existent infrastructure was in my way all the time I experimented with <em>IFilterExpressionProvider</em>, and I had to look deep inside the mechanisms of Dynamic Data to understand and find ways to come round its restrictions. And this leads me to only one conclusion - Dynamic Data was not designed to provide configurable filtering. So my answer on question about possibility of configurable filtering experience implementation with Dynamic Data is <em>yes</em>, but be careful what you wish for, since it was not designed for such kind of scenarios.</p>

<p>Here I did not mentioned how to save filters, but it is pretty simple, and all we need is to save somewhere associative array of "column-value" for a specific page. Complete source code is available on <a href="https://github.com/manekovskiy/Configurable-Dynamic-Data-Filters">GitHub</a> and you will need Visual Studio 11 Beta with localdb setup to run sample project.</p>

<p>I would gladly accept criticism, ideas or just thoughts on this particular scenario. Share, do coding and have fun!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[What Types Were Added, Moved or Became Public in .NET 4.5 Beta]]></title>
    <link href="http://manekovskiy.github.com//what-types-were-added-moved-or-became-public-in-net-4-5-beta/"/>
    <updated>2012-04-21T03:00:06+03:00</updated>
    <id>http://manekovskiy.github.com//what-types-were-added-moved-or-became-public-in-net-4-5-beta</id>
    <content type="html"><![CDATA[<p>There is a <a href="http://www.asp.net/vnext/overview/whitepapers/whats-new">whitepaper</a> about new features of ASP.NET 4.5, dozens of blog posts, videos from conferences, some tutorials and <a href="http://msdn.microsoft.com/en-us/library/ms171868(v=vs.110">MSDN</a>.aspx) topic describing overall changes. But why there are no reports about what types were actually added in .NET 4.5 Beta? Where are lists of "new types added to assembly N" or "types that became public in assembly N"? I understand that these lists are not very interesting and that it is more convenient to read descriptions of the new features. Nobody cares about details until they start working against you. And this is normal, right and ok, but now I have some free time and I want to share info about new types that were added or became public in .NET 4.5 comparing to .NET 4.0.</p>

<p>Why I became so interested in this? Well, I accidentally found that <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.ifilterexpressionprovider(v=vs.110"><em>System.Web.DynamicData.IFilterExpressionProvider</em></a>.aspx) interface became public. Briefly, this allows to work with <a href="http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.queryextender.aspx"><em>QueryExtender</em></a> and finally (I really wanted this since .NET 3.5) support its <a href="http://msdn.microsoft.com/en-us/library/system.web.dynamicdata.dynamicfilterexpression.aspx"><em>DynamicFilterExpression</em></a>. <del>Maybe on next weekend I'll post</del> I've already posted about <a href="http://amanek.com/?p=100">my experiments with IFilterExpressionProvider</a>, take a look if you are interested, and now lets return to the main topic.</p>

<p>It is pretty simple to do compiled assemblies diff if you have <a href="http://www.ndepend.com/">NDepend</a> or similar tool, but what if you (like me) have no license? I started thinking to enumerate public types via reflection, but soon recalled that <a href="http://www.west-wind.com/weblog/posts/2012/Mar/13/NET-45-is-an-inplace-replacement-for-NET-40">.NET 4.5 beta replaces assemblies of .NET 4.0</a> during installation and Assembly.LoadFrom will not work. To overcome this I decided to parse and compare XML documentation that comes along with all .NET assemblies. Simple as that, every public type is documented and difference between old and new version of documentation will give me at least names of types.</p>

<p>Ok, where to get xml documentation files for .NET 4.0? Binaries with xml docs of .NET 4.0 and 4.5 are located in <em><SysDrive>:\Program Files[(x86)]\Reference Assemblies\Microsoft\Framework.NETFramework</em>.</p>

<p><img class="center" src="/images/posts/reference-assemblies-folder.png" title="Reference assemblies folder location" alt="Reference assemblies folder location"></p>

<p>What I wanted is to get some statistics. There are 969 new public types in .NET 4.5. But it does not mean that those are completely new things, because it is not, it means that out of the box .NET 4.5 Beta has +969 new types comparing to .NET 4.0 and now there are totally 14971 public and documented types in .NET 4.5. Almost 15K only public types - that's incredibly huge number.</p>

<p><img class="center" src="/images/posts/comparison-of-types-count-between-net40-and-net45.png" title="Round Diagram showing types count of .NET 4.0 and .NET 4.5 Beta" alt="Round Diagram showing types count of .NET 4.0 and .NET 4.5 Beta"></p>

<p>Most of new types are located in <em>System.IdentityModel</em>, <em>System.Web</em> and <em>System.Windows.Controls.Ribbon</em> assemblies. Taking into account that <em>System.IdentityModel</em> is providing authentication and authorization features and <em>System.Windows.Controls.Ribbon</em> is UI library allowing use of Microsoft Ribbon for WPF, we can make a conclusion that vast amount of new changes is connected with web.</p>

<p><img class="center" src="/images/posts/new-types-count-by-assembly.png" title="Histogram of new types count by asembly" alt="Histogram of new types count by asembly"></p>

<p>But the most interesting thing was to examine minor changes and see that something new and really useful has been added. And I encourage you to look over list of new classes and I bet you will find something interesting.</p>

<p>LINQPad script with which I did the documentation comparison is listed below. Excel report with some diagrams is also available <a href="https://docs.google.com/open?id=0B4z0as-FFbTdaUVlOXZBblctRDQ">online</a>.</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="c1">// in case of non 64 bit system change &quot;Program Files (x86)&quot; to &quot;Program Files&quot;</span>
</span><span class='line'><span class="kt">string</span> <span class="n">net40Dir</span> <span class="p">=</span> <span class="s">@&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.0\&quot;</span><span class="p">;</span>
</span><span class='line'><span class="kt">string</span> <span class="n">net45Dir</span> <span class="p">=</span> <span class="s">@&quot;C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.5\&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 1. Get all types from all xml doc files in both directories that are containing .NET assemblies and group them by assemblies</span>
</span><span class='line'><span class="kt">var</span> <span class="n">net40Grouped</span> <span class="p">=</span> <span class="n">GetPublicTypesByAssembly</span><span class="p">(</span><span class="n">net40Dir</span><span class="p">);</span>
</span><span class='line'><span class="kt">var</span> <span class="n">net45Grouped</span> <span class="p">=</span> <span class="n">GetPublicTypesByAssembly</span><span class="p">(</span><span class="n">net45Dir</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 2. Get list of newly added assemblies</span>
</span><span class='line'><span class="kt">var</span> <span class="n">newAssemblies</span> <span class="p">=</span> <span class="n">net45Grouped</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">!</span><span class="n">net40Grouped</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;New assemblies in .NET 4.5 Beta: (total count - {0})&quot;</span><span class="p">,</span> <span class="n">newAssemblies</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'><span class="n">newAssemblies</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 3. Get all assemblies that are not present in .NET 4.5 beta</span>
</span><span class='line'><span class="kt">var</span> <span class="n">nonExistentAssemblies</span> <span class="p">=</span> <span class="n">net40Grouped</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">!</span><span class="n">net45Grouped</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">)).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Assemblies that are not present in .NET 4.5 Beta folder comparing to .NET 4.0: (total count - {0})&quot;</span><span class="p">,</span> <span class="n">nonExistentAssemblies</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'><span class="n">nonExistentAssemblies</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 4. Get all new types in .NET 4.0 and .NET 4.5 Beta assemblies</span>
</span><span class='line'><span class="kt">var</span> <span class="n">net40</span> <span class="p">=</span> <span class="n">net40Grouped</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'><span class="kt">var</span> <span class="n">net45</span> <span class="p">=</span> <span class="n">net45Grouped</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">newTypes</span> <span class="p">=</span> <span class="n">net45</span><span class="p">.</span><span class="n">Except</span><span class="p">(</span><span class="n">net40</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Types count in .NET 4.0:|{0}&quot;</span><span class="p">,</span> <span class="n">net40</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Types count in .NET 4.5 Beta:|{0}&quot;</span><span class="p">,</span> <span class="n">net45</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;New types count in .NET 4.5 Beta comparing to .NET 4.0:|{0}&quot;</span><span class="p">,</span> <span class="n">newTypes</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 5. Get assemblies that are containing new types</span>
</span><span class='line'><span class="kt">var</span> <span class="n">assembliesWithChanges</span> <span class="p">=</span> <span class="n">net45Grouped</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">newTypes</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">type</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">ContainsValue</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="n">Value</span><span class="p">)));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 6. Remove existent in .NET 4.0 types from assembliesWithChanges to get clear lists of new types grouped by assemblies</span>
</span><span class='line'><span class="kt">var</span> <span class="n">newTypesGrouped</span> <span class="p">=</span> <span class="n">assembliesWithChanges</span>
</span><span class='line'>    <span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">typesGroup</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">typesGroup</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">typesGroup</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">typesGroup</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Except</span><span class="p">(</span><span class="n">net40</span><span class="p">)</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">kvp</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">).</span><span class="n">ToList</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;New types by assembly:&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">assemblyWithNewTypes</span> <span class="k">in</span> <span class="n">newTypesGrouped</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;{0}|{1}&quot;</span><span class="p">,</span> <span class="n">assemblyWithNewTypes</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">assemblyWithNewTypes</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">typeName</span> <span class="k">in</span> <span class="n">assemblyWithNewTypes</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">typeName</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;</span><span class="n">Dictionary</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">GetPublicTypesByAssembly</span><span class="p">(</span><span class="kt">string</span> <span class="n">xmlDocsDirectory</span><span class="p">)</span>
</span><span class='line'><span class="p">{&lt;/</span><span class="n">p</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">pre</span><span class="p">&gt;&lt;</span><span class="n">code</span><span class="p">&gt;</span><span class="kt">string</span><span class="p">[]</span> <span class="n">xmlDocFiles</span> <span class="p">=</span> <span class="n">Directory</span><span class="p">.</span><span class="n">GetFiles</span><span class="p">(</span><span class="n">xmlDocsDirectory</span><span class="p">,</span> <span class="s">&quot;*.xml&quot;</span><span class="p">);</span>
</span><span class='line'><span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span> <span class="n">Dictionary</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;&amp;</span><span class="n">gt</span><span class="p">;();</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">xmlDoc</span> <span class="k">in</span> <span class="n">xmlDocFiles</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">root</span> <span class="p">=</span> <span class="n">XDocument</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">xmlDoc</span><span class="p">).</span><span class="n">Root</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">root</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">members</span> <span class="p">=</span> <span class="n">root</span><span class="p">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&quot;members&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">members</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">typesByAssembly</span> <span class="p">=</span> <span class="n">members</span><span class="p">.</span><span class="n">Elements</span><span class="p">(</span><span class="s">&quot;member&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">e</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;T:&quot;</span><span class="p">))</span>
</span><span class='line'>        <span class="p">.</span><span class="n">ToDictionary</span><span class="p">(</span><span class="n">e</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">GetHashCode</span><span class="p">(),</span> <span class="n">e</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">2</span><span class="p">)</span> <span class="cm">/* T: */</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">result</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">GetFileNameWithoutExtension</span><span class="p">(</span><span class="n">xmlDoc</span><span class="p">)</span> <span class="p">+</span> <span class="s">&quot;.dll&quot;</span><span class="p">,</span> <span class="n">typesByAssembly</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span><span class='line'><span class="p">&lt;/</span><span class="n">code</span><span class="p">&gt;&lt;/</span><span class="n">pre</span><span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span><span class="n">p</span><span class="p">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And at the end here are links that will help a bit to embrace the changes of .NET 4.5 Beta:</p>

<ul>
<li><a href="http://msdn.microsoft.com/en-us/library/ms171868(v=vs.110).aspx">What's New in the .NET Framework 4.5 Beta</a></li>
<li><a href="http://channel9.msdn.com/Events/BUILD/BUILD2011/TOOL-813T">Deep dive into the kernel of the .NET Framework</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/bb822049(v=vs.110).aspx">.NET Framework Versions and Dependencies</a></li>
<li><a href="http://msdn.microsoft.com/en-us/library/ee461502(v=vs.110).aspx">What's Obsolete in the .NET Framework</a></li>
<li><a href="http://go.microsoft.com/fwlink/?LinkID=237569">List of known issues in .NET 4.5 Beta</a></li>
</ul>


<p>Happy digging in new .NET and don't hesitate sharing!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How Internet Archive Saved My Day]]></title>
    <link href="http://manekovskiy.github.com//how-internet-archive-saved-my-day/"/>
    <updated>2012-01-09T16:09:50+02:00</updated>
    <id>http://manekovskiy.github.com//how-internet-archive-saved-my-day</id>
    <content type="html"><![CDATA[<blockquote><p>UPDATE: <strong>igoogle_themes.zip</strong> archive is no longer available through Wayback Machine since it is pointing to <strong>mattberseth2.com</strong> which is not working. However archive could be found on my <a href="http://sdrv.ms/XpvZMi" title="igoogle_themes.zip">SkyDrive</a>.</p></blockquote>

<p><img class="right" src="http://www.archive.org/images/wayback.gif" title="Internet Wayback Machine Logo" alt="Internet Wayback Machine Logo"> Today when I had to find a theme for ASP.NET GridView the first resource I found in my memory was <a href="http://mattberseth.com/">Matt Berseth's blog</a> (Google also found something for me but I'm convinced that "favorites list" in my memory is a much better and reliable source). Matt had great examples of AJAXcontrol extenders and some other things connected with styling of ASP.NET controls on his site. But while domain still belongs to Matt Berseth, the site is currently down and not available.</p>

<p>Well, I quickly found some references to the article <a href="http://mattberseth.com/blog/2007/11/5_gridview_themes_based_on_goo.html">5 GridView Themes Based on Google's Personalized Homepage (igoogle)</a> and tried to get to it with the help of <a href="http://archive.org/">The Internet Archive</a> (aka The Wayback Machine). From the "About the Wayback Machine" section:</p>

<blockquote><p>Browse through over 150 billion web pages archived from 1996 to a few months ago.</p></blockquote>

<p>In fact it never helped me, but Iwanted to get rarely visited pages or downloads of a big size so it is nothing to complain. And at this time I was interested in recovery of popular resource andto my reliefthe page was crawled <a href="http://wayback.archive.org/web/*/http://mattberseth.com/blog/2007/11/5_gridview_themes_based_on_goo.html">20 times</a> from the 3rd of November, 2007. And sample project download was also available! So it took me something near to 20 minutes to get what I wanted and this is nothing comparing to the efforts needed to create my own CSS for a GridView.</p>

<p>Thank you Internet Archive, you saved my day!</p>
]]></content>
  </entry>
  
</feed>
